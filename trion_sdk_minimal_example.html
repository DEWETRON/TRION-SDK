

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TRION SDK Minimal Example &mdash; TRION SDK  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TRION API C Interface" href="trion_api_c_interface.html" />
    <link rel="prev" title="TRION SDK Build Instructions" href="trion_sdk_build_instructions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> TRION SDK
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="trion_introduction.html">Introduction to TRION Measurement Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="trion_system_overview.html">TRION and TRIONet System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="trion_sdk_build_instructions.html">TRION SDK Build Instructions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">TRION SDK Minimal Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#trion-simulation">TRION Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-minimalexample">Example: MinimalExample</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-does-the-example-actually-do">What does the example actually do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-missing-in-the-example">What is missing in the example?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-tips">Debugging Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trionet">TRIONet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="trion_api_c_interface.html">TRION API C Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="trion_api_details.html">TRION API in Depth</a></li>
<li class="toctree-l1"><a class="reference internal" href="trion_api_xml.html">TRION API XML Documents</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TRION SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>TRION SDK Minimal Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="trion-sdk-minimal-example">
<h1>TRION SDK Minimal Example<a class="headerlink" href="#trion-sdk-minimal-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="trion-simulation">
<h2>TRION Simulation<a class="headerlink" href="#trion-simulation" title="Permalink to this headline">¶</a></h2>
<p>DEWETRON Explorer can be used to setup a valid TRION simulation to run the following example.
This way no TRION devices have to be connected to test the example. The simulated sample data is a generated sine wave.</p>
<div class="figure align-center" id="id1">
<img alt="_images/dex_sim.png" src="_images/dex_sim.png" />
<p class="caption"><span class="caption-text">DEWETRON Explorer simulation setup</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any simulation is automatically deactivated if real TRION hardware is found.</p>
</div>
</div>
<div class="section" id="example-minimalexample">
<h2>Example: MinimalExample<a class="headerlink" href="#example-minimalexample" title="Permalink to this headline">¶</a></h2>
<p>This example is part of the SDK and found here:
TRION_SDK/trion/C/analog/MinimalExample/minimal_example.c</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">MinimalExample</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Short example to describe how an analog channel is read.</span>
<span class="cm"> * This example should be used with a TRION board featuring analog channels</span>
<span class="cm"> *</span>
<span class="cm"> * Describes following:</span>
<span class="cm"> *  - Setup of 1 AI channel</span>
<span class="cm"> *  - Print unscaled analog values.</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&quot;dewepxi_apicore.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;dewepxi_apiutil.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;dewepxi_types.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;trion_sdk_util.h&quot;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">nBoardId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">sBoardId</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="kt">char</span> <span class="n">sTarget</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span>    <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="kt">char</span> <span class="n">sErrorText</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="kt">char</span> <span class="n">sSetingBuff</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="kt">int</span> <span class="n">nNoOfBoards</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nErrorCode</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">fRange</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>  <span class="c1">//V</span>
    <span class="kt">char</span> <span class="n">sRangeStr</span><span class="p">[</span><span class="mi">48</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="kt">int</span> <span class="n">sample_offset</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

    <span class="c1">// Load pxi_api.dll</span>
    <span class="k">if</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">LoadTrionApi</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Initialize driver and retrieve the number of TRION boards</span>
    <span class="c1">// nNoOfBoards is a negative number if system is in DEMO mode!</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeDriverInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nNoOfBoards</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
    <span class="n">nNoOfBoards</span><span class="o">=</span><span class="n">abs</span><span class="p">(</span><span class="n">nNoOfBoards</span><span class="p">);</span>

    <span class="c1">// Check if TRION cards are in the system</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nNoOfBoards</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">UnloadTrionApi</span><span class="p">(</span><span class="s">&quot;No Trion cards found. Aborting...</span><span class="se">\n</span><span class="s">Please configure a system using the DEWE2 Explorer.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Build BoardId -&gt; Either comming from command line (arg 1) or default &quot;0&quot;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">TRUE</span> <span class="o">!=</span> <span class="n">ARG_GetBoardId</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">nNoOfBoards</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nBoardId</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">sErrorText</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sErrorText</span><span class="p">),</span> <span class="s">&quot;Invalid BoardId: %d</span><span class="se">\n</span><span class="s">Number of found boards: %d&quot;</span><span class="p">,</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">nNoOfBoards</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">UnloadTrionApi</span><span class="p">(</span><span class="n">sErrorText</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Build BoardIDX string for _str functions</span>
    <span class="n">snprintf</span><span class="p">(</span><span class="n">sBoardId</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sBoardId</span><span class="p">),</span> <span class="s">&quot;BoardID%d&quot;</span><span class="p">,</span> <span class="n">nBoardId</span><span class="p">);</span>

    <span class="c1">// Open &amp; Reset the board</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_OPEN_BOARD</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_RESET_BOARD</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

    <span class="c1">// Set configuration to use one board in standalone operation</span>
    <span class="n">snprintf</span><span class="p">(</span><span class="n">sTarget</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sTarget</span><span class="p">),</span><span class="s">&quot;%s/%s&quot;</span><span class="p">,</span> <span class="n">sBoardId</span><span class="p">,</span> <span class="s">&quot;AcqProp&quot;</span><span class="p">);</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParamStruct_str</span><span class="p">(</span> <span class="n">sTarget</span><span class="p">,</span> <span class="s">&quot;OperationMode&quot;</span><span class="p">,</span> <span class="s">&quot;Slave&quot;</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParamStruct_str</span><span class="p">(</span> <span class="n">sTarget</span><span class="p">,</span> <span class="s">&quot;ExtTrigger&quot;</span><span class="p">,</span> <span class="s">&quot;False&quot;</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParamStruct_str</span><span class="p">(</span> <span class="n">sTarget</span><span class="p">,</span> <span class="s">&quot;ExtClk&quot;</span><span class="p">,</span> <span class="s">&quot;False&quot;</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParamStruct_str</span><span class="p">(</span> <span class="n">sTarget</span><span class="p">,</span> <span class="s">&quot;SampleRate&quot;</span><span class="p">,</span> <span class="s">&quot;2000&quot;</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

    <span class="c1">// Disable all channels</span>
    <span class="n">snprintf</span><span class="p">(</span><span class="n">sTarget</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sTarget</span><span class="p">),</span> <span class="s">&quot;%s/%s&quot;</span><span class="p">,</span> <span class="n">sBoardId</span><span class="p">,</span> <span class="s">&quot;ChannelAll&quot;</span><span class="p">);</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParamStruct_str</span><span class="p">(</span> <span class="n">sTarget</span> <span class="p">,</span> <span class="s">&quot;Used&quot;</span><span class="p">,</span> <span class="s">&quot;False&quot;</span><span class="p">);</span>

    <span class="c1">// Enable one analog channel will be enabled (AI)</span>
    <span class="n">snprintf</span><span class="p">(</span><span class="n">sTarget</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sTarget</span><span class="p">),</span> <span class="s">&quot;%s/%s&quot;</span><span class="p">,</span> <span class="n">sBoardId</span><span class="p">,</span> <span class="s">&quot;AI0&quot;</span><span class="p">);</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParamStruct_str</span><span class="p">(</span> <span class="n">sTarget</span> <span class="p">,</span> <span class="s">&quot;Used&quot;</span><span class="p">,</span> <span class="s">&quot;True&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nErrorCode</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">sErrorText</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sErrorText</span><span class="p">),</span> <span class="s">&quot;Could not enable AI channel on board %d: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">DeWeErrorConstantToString</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">UnloadTrionApi</span><span class="p">(</span><span class="n">sErrorText</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Setup the acquisition buffer: Size = BLOCK_SIZE * BLOCK_COUNT</span>
    <span class="c1">// For the default samplerate 2000 samples per second, 200 is a buffer for</span>
    <span class="c1">// 0.1 seconds</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_BLOCK_SIZE</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
    <span class="c1">// Set the ring buffer size to 50 blocks. So ring buffer can store samples</span>
    <span class="c1">// for 5 seconds</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_BLOCK_COUNT</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

    <span class="c1">// Update the hardware with settings</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_UPDATE_PARAM_ALL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

    <span class="c1">// Data Acquisition - stopped with any key</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_START_ACQUISITION</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nErrorCode</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sint64</span> <span class="n">nBufStartPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">sint64</span> <span class="n">nBufEndPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>         <span class="c1">// Last position in the ring buffer</span>
        <span class="kt">int</span> <span class="n">nBufSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>              <span class="c1">// Total buffer size</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Measurement Started on Brd: %s/AI0:..</span><span class="se">\n\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">sBoardId</span><span class="p">);</span>
        <span class="c1">// Get detailed information about the ring buffer</span>
        <span class="c1">// to be able to handle the wrap around</span>
        <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeGetParam_i64</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_START_POINTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nBufStartPos</span><span class="p">);</span>
        <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
        <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeGetParam_i64</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_END_POINTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nBufEndPos</span><span class="p">);</span>
        <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
        <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeGetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_TOTAL_MEM_SIZE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nBufSize</span><span class="p">);</span>
        <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

        <span class="k">while</span><span class="p">(</span> <span class="o">!</span><span class="n">kbhit</span><span class="p">()</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sint64</span> <span class="n">nReadPos</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>       <span class="c1">// Pointer to the ring buffer read pointer</span>
            <span class="kt">int</span> <span class="n">nAvailSamples</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="n">sint32</span> <span class="n">nRawData</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

            <span class="c1">//Sleep(100);</span>

            <span class="c1">// Get the number of samples already stored in the ring buffer</span>
            <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeGetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_AVAIL_NO_SAMPLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nAvailSamples</span> <span class="p">);</span>
            <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ERR_BUFFER_OVERWRITE</span> <span class="o">==</span> <span class="n">nErrorCode</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Measurement Buffer Overflow happened - stopping measurement</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// skip if number of samples is smaller than the current ADC delay</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nAvailSamples</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Get the current read pointer</span>
            <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeGetParam_i64</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_ACT_SAMPLE_POS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nReadPos</span> <span class="p">);</span>
            <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

            <span class="c1">// Read the current samples from the ring buffer</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nAvailSamples</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// Handle the ring buffer wrap around</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nReadPos</span> <span class="o">&gt;=</span> <span class="n">nBufEndPos</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">nReadPos</span> <span class="o">-=</span> <span class="n">nBufSize</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// Get the sample value at the read pointer of the ring buffer</span>
                <span class="c1">// The sample value is 24Bit (little endian, encoded in 32bit).</span>
                <span class="n">nRawData</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">sint32</span><span class="o">*</span><span class="p">)</span><span class="n">nReadPos</span><span class="p">;</span>

                <span class="p">{</span>
                    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Raw: %8.8x&quot;</span><span class="p">,</span> <span class="n">nRawData</span><span class="p">);</span>
                    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// Increment the read pointer</span>
                <span class="n">nReadPos</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">uint32</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Free the ring buffer after read of all values</span>
            <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_BUFFER_FREE_NO_SAMPLE</span><span class="p">,</span> <span class="n">nAvailSamples</span> <span class="p">);</span>
            <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Stop data acquisition</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_STOP_ACQUISITION</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

    <span class="c1">// Close the board connection</span>
    <span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParam_i32</span><span class="p">(</span> <span class="n">nBoardId</span><span class="p">,</span> <span class="n">CMD_CLOSE_BOARD</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CheckError</span><span class="p">(</span><span class="n">nErrorCode</span><span class="p">);</span>

    <span class="c1">// Unload pxi_api.dll</span>
    <span class="n">UnloadTrionApi</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">End Of Example</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">nErrorCode</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="what-does-the-example-actually-do">
<h2>What does the example actually do?<a class="headerlink" href="#what-does-the-example-actually-do" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Line 10-12: include the necessary TRION API SDK headers.</p></li>
<li><p>Line 13: includes trion_sdk_util.h with utility functions.</p></li>
<li><p>Line 30: LoadTrionApi() calls DeWePxiLoad(), dynamically loading dwpxi_api_x64.dll</p></li>
<li><p>Line 37: DeWeDriverInit() is initializing the API.</p></li>
<li><p>Line 39: If simulation is enabled (eg in DEWETRON Explorer), the board count is returned as negative number.</p></li>
<li><p>Line 48: ARG_GetBoardId() is provided by trion_sdk_util.h to ease command line handling.</p></li>
<li><p>Line 55: All string based functions need a board indexing string in the format “BoardId0”, “BoardId1”,…</p></li>
<li><p>Line 58 and 60: open the board for logic operations and put it into a defined default-state. After this step, the logical configuration is put into a default-state. The actual default-values for any given board can be examined by looking at the XML-Description.</p></li>
<li><p>Line 64 to 72: Configure acquisition properties to use the board in standalone operation:</p>
<blockquote>
<div><ul class="simple">
<li><p>‘OperationMode=Slave’</p></li>
<li><p>‘ExtTrigger=False’</p></li>
<li><p>‘ExtClock=False’</p></li>
<li><p>‘SampleRate=2000’, the sample rate is set to 2kHz.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Line 75-76: Disable all channels</p></li>
<li><p>Line 79-80: Enable analog channel: AI0</p></li>
<li><p>Line 90-95: Setup the ringbuffer for the data-acquisition. To do so, the driver has to know how big we want the buffer to be. This is usually depending on the applications desired polling-interval and its capability to process the data. This allows for a fine granulated control for the application and can for example be used to setup the block-size and polling interval in a way to exploit the CPU-internal caches most efficient, when it comes to more than simple data-acquisition (like when complicated mathematical evaluation has to be applied to the acquired samples).</p></li>
<li><p>Line 98: Apply the complete setup to hardware and configre the acquisition environment, like allocating the ringbuffer. From this point on it is possible to query the API for detailed information about the ring-buffer necessary to process the acquired data.</p></li>
<li><p>Line 102: Starts the actual acquisition of data. From that point on the application is able to see data in the acquisition buffer. After starting the acquisition the example code polls the API for new data.</p></li>
<li><p>Line 113-118: Retrieve pointer to the DMA ring buffer: START_POINTER, END_POINTER (end MEM_SIZE just to verify the setup)</p></li>
<li><p>Line 120: Here begins the acquisition loop. It can be stopped by any key press.</p></li>
<li><p>Line 130: Get the number of available new samples.</p></li>
<li><p>Line 145: Get the start pointer to the ringbuffer to read new samples.</p></li>
<li><p>Line 149: Iterate all read samples. The loop prints the value as raw hex.</p></li>
<li><p>Line 171: Free the already read part of the ringbuffer</p></li>
<li><p>Line 177: Stop data acquisition.</p></li>
<li><p>Line 181: Close the connection to board by the driver.</p></li>
<li><p>Line 185: UnloadTrionApi() unloads and uninitializes TRION API.</p></li>
</ul>
</div>
<div class="section" id="what-is-missing-in-the-example">
<h2>What is missing in the example?<a class="headerlink" href="#what-is-missing-in-the-example" title="Permalink to this headline">¶</a></h2>
<p>From point of most basic operation the example code is complete.
More sophisticated channel-setups or more sophisticated system setups, involving more boards, and even multi-enclosure synchronization scenarios are not that different.
All of these tasks can be achieved by setting the desired properties with the same string-base-functions.</p>
<p>The biggest simplification in the sample-code surly is the hardcoded assumption about the scan-layout, the description how the samples are ordered in the ringbuffer.
As long as only one channel of known data-width is used, this is easy.
See Chapter XXX about more details about the scan-layout.
Real production code would have to process this API-provided information to navigate within the buffer.
There are several ways the application could use this meta-information for navigation.
Depending on its own internal needs, the application may choose to process the acquired data scan-by-scan or channel-by-channel.
Even multi-threaded approaches are easily possible.</p>
</div>
<div class="section" id="debugging-tips">
<h2>Debugging Tips<a class="headerlink" href="#debugging-tips" title="Permalink to this headline">¶</a></h2>
<p>During debugging of the example developers will often get the error: ERR_BUFFER_OVERWRITE. This happens because the TRION hardware does
not know that the acquisition is paused by hitting a breakpoint.</p>
<p>So it will continue to fill the ringbuffer until it is full. Using the ringbuffer configuration of the example above this would happen in 5 seconds.</p>
<p><strong>There is a workaround if TRION API is used in simulation mode (TRION 5.1 or better):</strong></p>
<p>Add the line after DeWeDriverInit():</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">nErrorCode</span> <span class="o">=</span> <span class="n">DeWeSetParamStruct_str</span><span class="p">(</span><span class="s">&quot;driver/api/TrionSystemSim&quot;</span><span class="p">,</span> <span class="s">&quot;SET_OVERFLOW_ERROR_POLICY&quot;</span><span class="p">,</span> <span class="s">&quot;OVERFLOW_ERROR_IGNORE&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The allowed values for this setting are:</p>
<ul class="simple">
<li><p>OVERFLOW_ERROR_CHECK (default value)</p></li>
<li><p>OVERFLOW_ERROR_IGNORE deactivates ringbuffer overflow simulation</p></li>
</ul>
<p>This setting does not influence measurement with real hardware.</p>
</div>
<div class="section" id="trionet">
<h2>TRIONet<a class="headerlink" href="#trionet" title="Permalink to this headline">¶</a></h2>
<p>The example can also be run with a TRIONet device with minimal change. Please refer to</p>
<p>TRION-SDK/trionet/C/analog/TN_OneAnalogChannel/tn_one_analog_channel.c</p>
<p>for details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Changes needed are:</p>
<ul class="simple">
<li><p>network setup</p></li>
<li><p>loading dwpxi_net_api_x64.dll instead of dwpxi_api_x64.dll</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="trion_api_c_interface.html" class="btn btn-neutral float-right" title="TRION API C Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="trion_sdk_build_instructions.html" class="btn btn-neutral float-left" title="TRION SDK Build Instructions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, DEWETRON GmbH

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>